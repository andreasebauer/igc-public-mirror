{% extends "base.html" %}
{% set back_url = '/metrics/select/' ~ sim.id %}
{% set primary_kind = 'submit' %}
{% set primary_label = 'Next' %}
{% set primary_url = None %}
{% set primary_disabled = False %}
{% set primary_form_id = 'metrics-confirm-form' %}
{% block content %}
{% if is_sweep %}
<section class="card">
  <header class="igc-header">
    <h3>Metrics sweep</h3>
    <p class="igc-subtitle">
      {{ sim.label }} · {{ sim.name }} — all runs under this Sweep folder will be processed.
    </p>
  </header>
<p class="muted" style="margin: 0.25rem 0 0.75rem 0;">
  <strong>Sweep root:</strong> {{ run_root }}
</p>
</section>
{% endif %}

<section class="card">
<section class="card">
<header class="igc-header">  
  <h3>Chosen metrics:</h3>
  <p class="igc-subtitle">{{ sim.label }} · {{ sim.name }} — {{ total_selected }} selected</p>
</header>

<form id="metrics-confirm-form" method="post" action="/metrics/{{ sim.id }}/save" class="stack">
  <section class="group-grid">
  {% for g in groups %}
    <div class="igc-card">
      <div class="group-head"><h3>{{ g.name }}</h3></div>
      <ul class="stack" style="margin:.25rem 0 .5rem 0;">
        {% if g.metrics %}
          {% for m in g.metrics %}
            <li>{{ m.name }}</li>
          {% endfor %}
        {% else %}
          <li class="muted">None</li>
        {% endif %}
      </ul>
    </div>
  {% endfor %}
  </section>

  {# Re-post all selected ids to save #}
      <input type="hidden" name="run_root" value="{{ run_root }}"/>
  {% for mid in metric_ids %}
    <input type="hidden" name="metric_ids" value="{{ mid }}"/>
  {% endfor %}


</form>
</section>
<style>
.group-grid{display:grid;gap:16px;grid-template-columns:repeat(auto-fit,minmax(320px,1fr));}
.igc-card ul{list-style:disc;padding-left:1.5rem;}
.muted{opacity:.6;}
/* Smaller header + list text only for this page */
.igc-header h1 {
  font-size: 1.25rem;   /* ~18 px instead of default 24 px */
  margin-bottom: 2px;
}

.group-grid h3,
.group-grid li {
  font-size: 0.9rem;    /* ~14 px */
  line-height: 0.75;
}
</style>
{% endblock %}
